---
layout: post
title:  "SQL技巧"
date:   2016-10-08 15:14:54
categories: SQL
tags: SQL
excerpt: 记录SQL的一些技巧

---

* content
{:toc}



## SQL行转列

`(case when ...=... then ...end) as ...`

## SQL列转行

##### 单一字段拆分列转行

例如mobile字段用**，**分隔

| **id** | mobile                         |
| ------ | ------------------------------ |
| 1      | 123214，1232133234，234234324324 |
| 2      | 123124，324325                  |
| 3      | 324234，234325，1231412，32432432 |

先创建一个序列表**tb_sequence**

`CREATE TABLE tb_sequence(id INT AUTO_INCREMENT NOT NULL, PRIMARY KEY(id))`

`INSERT INTO tb_sequence VALUES (),(),(),(),(),(),()...`

计算出**mobile**字段中**，**的数量

```
SELECT id, CONCAT(mobile,',') AS mobile, LENGTH(mobile)-LENGTH(REPLACE(mobile,',',''))+1 AS size 
FROM table
```

| id   | mobile | size |
| ---- | ------ | ---- |
| 1    | 。。。,   | 3    |
| 2    | 。。。,   | 2    |
| 3    | 。。。,   | 4    |

再同原表进行连接，产生结果行数

```
SELECT id, REPLACE(SUBSTRING(SUBSTRING_INDEX(mobile,',',a.id),CHAR_LENGTH(SUBSTRING_INDEX(mobile,',',a.id-1))+1),',','') AS mobile
FROM tb_sequence a CROSS JOIN (SELECT id, CONCAT(mobile,',') AS mobile, LENGTH(mobile)-LENGTH(REPLACE(mobile,',',''))+1 AS size
FROM table b) b ON a.id <= b.size
```

> 注：SUBSRTING_INDEX(str, delim, count) 返回字符串str中在第count个出现的分隔符delim之前的子串
>
> 注：SUBSRTING(str, start, length)返回字符串str中第start个字符开始长度为length的子串



##### 多个字段列转行

依次选择字段然后用union连接

```

```