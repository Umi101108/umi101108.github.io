---
layout: post
title:  "MySQL 数据库架构学习笔记-高可用架构设计"
date:   2017-05-04
categories: MySQL
tags: MySQL 架构
excerpt: 打造扛得住的MySQL数据库架构之高可用结构设计
---

* content
{:toc}


## MySQL复制功能

 MySQL复制功能提供分担**读负载**

为高可用、灾难恢复、备份等提供更多的选择

复制是异步的

####  复制解决了什么问题

* 实现在不同服务器上的数据分布

  利用二进制日志增量进行

  不需要太多的带宽

  但是使用基于行的复制在进行大批量的更改时会对带宽带来一定的压力，他别是跨IDC环境下进行复制

* 实现数据读取的负载均衡

  需要其他组件配合完成

  利用DNS轮询的方式把程序的读连接到不同的备份数据库

  使用LVS，haproxy这样的代理方式

  非共享架构，同样的数据分布在多台服务器上

* 增强了数据安全性

  利用备库的备份来减少主库负载

  复制并不能代替备份

  方便进行数据库高可用架构的部署，避免MySQL单点失败

* 实现数据库高可用的故障切换

* 实现数据库在线升级

   

## 二进制日志

* MySQL存储引擎层日志

  innodb重做日志、回滚日志

* MySQL服务器日志

  二进制日志、慢查日志、通用日志

### 二进制日志

记录了所有对MySQL数据库的修改事件，包括增删改查事件和对表结构的修改事件

#### 二进制日志的格式

* 基于段的格式 binlog_format=STATEMENT

  优点：

  * 日志记录量相对较小，节约磁盘及网络I/O

    只对一条记录修改或者插入，row格式所产生的日质量小于段产生的日志量

  缺点

  * 可能必须要记录上下文信息

    保证语句在从服务器上执行结果和主服务器相同

    特定函数如UUID()，user() 这样非确定性函数还是无法复制

  * 可能造成MySQL复制的主备服务器数据不一致

* 基于行的日志格式 binlog_format=ROW

  Row格式可以避免MySQL复制中出现的主从不一致问题

  同一SQL语句修改了10000条数据的情况下，基于段的日志格式只会记录这个SQL语句，而基于行的日志会有10000条记录分别记录每一行的数据修改

  优点：

  * 使MySQL主从复制更加安全
  * 对每一行数据的修改比基于段的复制高效
  * 误操作而修改了数据库中的数据，同时又没有备份可以恢复时，我们就可以通过分析二进制日志，对日志中记录的数据修改操作做反向处理来达到恢复数据的目的

  缺点

  * 记录日志量较大

    binlog_row_image = [Full|MINIMAL|NOBLOB]·

    ​